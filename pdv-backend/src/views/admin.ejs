<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - PDV Server</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f4f5f7; margin: 0; padding: 2rem; color: #333; }
        h1, h2 { color: #005A8D; }
        .container { max-width: 1200px; margin: auto; background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        th, td { padding: 0.75rem; border: 1px solid #ddd; text-align: left; }
        thead { background-color: #e8e8e8; }
        tbody tr:nth-child(even) { background-color: #f9f9f9; }
        .currency { text-align: right; }
        .items-list { list-style: none; padding: 0; margin: 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Painel do Servidor PDV</h1>
        <p>Esta página mostra os dados recebidos do Ponto de Venda. Atualize a página para ver novas vendas.</p>

        <h2>Últimas Vendas Recebidas</h2>
        <table>
            <thead>
                <tr>
                    <th>Data & Hora</th>
                    <th>ID da Venda (Cliente)</th>
                    <th>Operador</th>
                    <th>Itens</th>
                    <th class="currency">Total</th>
                </tr>
            </thead>
            <tbody>
                <% if (transactions.length === 0) { %>
                    <tr>
                        <td colspan="5" style="text-align: center;">Nenhuma venda recebida ainda.</td>
                    </tr>
                <% } else { %>
                    <% transactions.forEach(tx => { %>
                        <tr>
                           <td>
    <%# Cria um objeto de data e formata para o fuso horário de São Paulo %>
    <%= new Date(tx.processedAt).toLocaleString('pt-BR', { timeZone: 'America/Sao_Paulo' }) %>
</td>
                            <td><%= tx.clientTransactionId.substring(0, 8) %>...</td>
                            <td><%= tx.operatorId.substring(0, 8) %>...</td>
                            <td>
                                <ul class="items-list">
                                    <% tx.items.forEach(item => { %>
                                        <li><%= item.quantity %>x <%= item.name %></li>
                                    <% }) %>
                                </ul>
                            </td>
                            <td class="currency">R$ <%= (tx.totalCents / 100).toFixed(2) %></td>
                        </tr>
                    <% }) %>
                <% } %>
            </tbody>
        </table>

        <h2 style="margin-top: 3rem;">Produtos no Sistema</h2>
        <table>
            <thead>
                <tr>
                    <th>SKU</th>
                    <th>Nome</th>
                    <th class="currency">Preço</th>
                    <th>Estoque</th>
                </tr>
            </thead>
            <tbody>
                <% products.forEach(p => { %>
                    <tr>
                        <td><%= p.sku %></td>
                        <td><%= p.name %></td>
                        <td class="currency">R$ <%= (p.price / 100).toFixed(2) %></td>
                        <td><%= p.stock %></td>
                    </tr>
                <% }) %>
            </tbody>
        </table>
    </div>
</body>
</html>